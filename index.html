<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skoƒçko 5th Move Trainer</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .dot {
    display: inline-block;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    margin-left: 2px;
  }
  .dot.red { background-color: #ef4444; }    /* Tailwind red-500 */
  .dot.yellow { background-color: #facc15; } /* Tailwind yellow-400 */
</style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen flex flex-col items-center p-4 text-gray-800">

<div class="w-full max-w-md bg-white rounded-2xl shadow-lg p-6">
  <h1 class="text-2xl font-bold mb-4 text-center text-indigo-600">Skoƒçko 5th Move Trainer</h1>

  <!-- Controls -->
  <div class="space-y-3 mb-5">
    <div class="flex flex-wrap justify-center gap-2 items-center">
      <label class="font-medium">Max Reds:</label>
      <select id="maxRed" class="border rounded px-2 py-1 text-lg">
        <option value="4">4</option><option value="3">3</option>
        <option value="2" selected>2</option><option value="1">1</option><option value="0">0</option>
      </select>

      <label class="font-medium">Max Yellows:</label>
      <select id="maxYellow" class="border rounded px-2 py-1 text-lg">
        <option value="4">4</option><option value="3">3</option>
        <option value="2" selected>2</option><option value="1">1</option><option value="0">0</option>
      </select>
    </div>

    <label class="flex items-center justify-center gap-2 text-sm">
      <input type="checkbox" id="strictMode" class="scale-125 accent-indigo-500">
      <span>Strict mode</span>
    </label>

    <div class="flex flex-wrap justify-center gap-2">
      <button onclick="generateGame()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-medium">New Game</button>
      <button onclick="showSecret()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium">Show Solution</button>
      <button onclick="checkAllSolutions()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium">Check All</button>
    </div>
  </div>

  <!-- Attempts -->
  <div id="attempts" class="text-sm space-y-1 mb-4"></div>

  <!-- Guess -->
  <h3 class="text-lg font-semibold mb-2 text-center">Guess the 5th Move:</h3>
  <div class="flex justify-center gap-2 mb-3">
    <select id="g0" class="border rounded-lg text-xl px-2 py-1"></select>
    <select id="g1" class="border rounded-lg text-xl px-2 py-1"></select>
    <select id="g2" class="border rounded-lg text-xl px-2 py-1"></select>
    <select id="g3" class="border rounded-lg text-xl px-2 py-1"></select>
  </div>
  <div class="text-center">
    <button onclick="checkGuess()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium">Check</button>
  </div>

  <!-- Result -->
  <p id="result" class="mt-3 text-center text-lg font-semibold"></p>

  <!-- Possible List -->
  <pre id="possibleList" class="text-xs bg-gray-100 rounded-lg p-2 mt-3 overflow-x-auto max-h-48"></pre>
</div>

<script>
const symbols = ['S','‚ô•','‚ô¶','‚ô£','‚òÖ','‚ô†'];
const L = 4;

// Populate dropdowns
for(let i=0;i<L;i++){
  const sel = document.getElementById('g'+i);
  symbols.forEach(sym=>{
    const opt = document.createElement('option');
    opt.value = sym;
    opt.textContent = sym;
    sel.appendChild(opt);
  });
}

// Score function
function scoreGuess(secret, guess){
  let r=0, y=0;
  let secRem=[], gueRem=[];
  for(let i=0;i<L;i++){
    if(secret[i] === guess[i]) r++;
    else { secRem.push(secret[i]); gueRem.push(guess[i]); }
  }
  secRem.forEach(s=>{
    let idx = gueRem.indexOf(s);
    if(idx>=0){ y++; gueRem.splice(idx,1); }
  });
  return [r,y];
}

// Generate all combinations
function allCombinations(){
  const res=[];
  function helper(prefix){
    if(prefix.length===L){ res.push(prefix); return; }
    symbols.forEach(s=>helper(prefix.concat(s)));
  }
  helper([]);
  return res;
}

let secret=[], attempts=[];

function filterSolutions(attempt,rw,solutions){
  return solutions.filter(sol=>{
    const [r,y] = scoreGuess(sol,attempt);
    return r===rw[0] && y===rw[1];
  });
}

// Generate game (strict or relaxed)
function generateGame(){
  const maxRed = parseInt(document.getElementById('maxRed').value);
  const maxYellow = parseInt(document.getElementById('maxYellow').value);
  const strict = document.getElementById('strictMode').checked;
  const all = allCombinations();

  attempts = [];
  let success=false;

  while(!success){
    // Pick secret randomly
    secret = [];
    for(let i=0;i<L;i++) secret.push(symbols[Math.floor(Math.random()*symbols.length)]);

    let possible=[...all];
    attempts=[];

    const relaxLimit = strict ? 0 : 5;

    let relax=0;
    while(relax <= relaxLimit){
      possible=[...all];
      attempts=[];
      let failed=false;

      for(let step=0; step<4; step++){
        let candidates=[];
        // Generate candidate attempts
        for(let t=0;t<300;t++){
          let cand=[];
          for(let i=0;i<L;i++) cand.push(symbols[Math.floor(Math.random()*symbols.length)]);
          const [r,y] = scoreGuess(secret,cand);

          if(r <= maxRed + relax && y <= maxYellow + relax){
            let filtered = filterSolutions(cand,[r,y],possible);
            if(filtered.length>0) candidates.push([cand,[r,y]]);
          }
        }

        if(candidates.length===0){
          failed=true;
          break;
        }

        // Pick random candidate
        let choice = candidates[Math.floor(Math.random()*candidates.length)];
        attempts.push(choice);
        possible = filterSolutions(choice[0],choice[1],possible);
      }

      if(!failed && possible.length===1){
        success=true;
        break;
      }

      relax++;
    }
  }

  // Display
  const div = document.getElementById('attempts');
  div.innerHTML='';
  attempts.forEach((a,i)=>{
    const [r,y] = a[1];
    const row = document.createElement('div');
    row.className='attempt flex justify-between items-center border-b py-1';
    let dots='';
    for(let k=0;k<r;k++) dots+='<span class="dot red"></span>';
    for(let k=0;k<y;k++) dots+='<span class="dot yellow"></span>';
    row.innerHTML=`
      <div class="font-semibold w-20">Try ${i+1}:</div>
      <div class="flex-1 text-center text-lg tracking-wider">${a[0].join(' ')}</div>
      <div class="flex justify-end w-20">${dots}</div>`;
    div.appendChild(row);
  });

  document.getElementById('result').textContent='';
  document.getElementById('possibleList').textContent='';
  console.log("Secret:",secret);
}

function checkGuess(){
  let g=[];
  for(let i=0;i<L;i++) g.push(document.getElementById('g'+i).value);
  if(g.join('')===secret.join('')){
    document.getElementById('result').textContent='‚úÖ Correct! You found the 5th move!';
  } else {
    document.getElementById('result').textContent=`‚ùå Wrong. Secret was: ${secret.join(' ')}`;
  }
}

function showSecret(){
  document.getElementById('result').textContent='üí° Secret: '+secret.join(' ');
}

function checkAllSolutions(){
  const all = allCombinations();
  let poss=[...all];
  attempts.forEach(a=>{
    poss = filterSolutions(a[0],a[1],poss);
  });
  document.getElementById('possibleList').textContent=`Possible secrets (${poss.length}):\n`+poss.map(p=>p.join(' ')).join('\n');
}

generateGame();
</script>
</body>
</html>
