<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Skoƒçko 5th Move Trainer (Unique Solution + Controls)</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  select, input { font-size: 18px; margin: 2px; }
  .attempt { margin-bottom: 10px; }
  .controls { margin-top: 20px; }
</style>
</head>
<body>
<h1>Skoƒçko 5th Move Trainer (Unique Solution)</h1>

<div id="controls" class="controls">
  <button onclick="initGame()">Refresh Game</button>
  <button onclick="revealSolution()">Show Solution</button>
</div>

<div id="attemptSelectors" class="controls">
  <p>Set max Red/White for each attempt:</p>
  <div id="maxSelectors"></div>
</div>

<div id="attempts"></div>

<h3>Guess the 5th move:</h3>
<select id="g0"></select>
<select id="g1"></select>
<select id="g2"></select>
<select id="g3"></select>
<button onclick="checkGuess()">Check</button>

<p id="result"></p>

<script>
const symbols = ['S','‚ô•','‚ô¶','‚ô£','‚òÖ','‚óã'];
const L = 4;

let secret = [];
let attempts = [];
let possibleSolutions = [];
let maxSettings = [];

// Fill dropdowns for 5th guess
function fillGuessDropdowns(){
  for(let i=0;i<L;i++){
    const sel = document.getElementById('g'+i);
    sel.innerHTML = '';
    symbols.forEach(sym=>{
      const opt = document.createElement('option');
      opt.value = sym;
      opt.textContent = sym;
      sel.appendChild(opt);
    });
  }
}

// Function to compute red/white points
function scoreGuess(secret, guess){
  let red = 0;
  let secRem = [], gueRem = [];
  for(let i=0;i<L;i++){
    if(secret[i]==guess[i]) red++;
    else { secRem.push(secret[i]); gueRem.push(guess[i]); }
  }
  let white = 0;
  secRem.forEach(s=>{
    let index = gueRem.indexOf(s);
    if(index>=0){
      white++;
      gueRem.splice(index,1);
    }
  });
  return [red, white];
}

// Generate all possible combinations (solution space)
function allCombinations(symbols, L){
  let result = [];
  function helper(prefix){
    if(prefix.length===L){
      result.push(prefix);
      return;
    }
    symbols.forEach(s=>{
      helper(prefix.concat(s));
    });
  }
  helper([]);
  return result;
}

// Filter solution space
function filterSolutions(attempt, rw){
  possibleSolutions = possibleSolutions.filter(sol=>{
    let [r,w] = scoreGuess(sol, attempt);
    return r===rw[0] && w===rw[1];
  });
}

// Generate single attempt with optional max red/white
function generateCandidate(maxRed, maxWhite){
  let candidate = [];
  for(let i=0;i<L;i++){
    candidate.push(symbols[Math.floor(Math.random()*symbols.length)]);
  }
  let [r,w] = scoreGuess(secret, candidate);
  let tries = 0;
  while((r>maxRed || w>maxWhite) && tries<50){
    let pos = Math.floor(Math.random()*L);
    let randSym;
    do { randSym = symbols[Math.floor(Math.random()*symbols.length)]; } while(randSym===candidate[pos]);
    candidate[pos] = randSym;
    [r,w] = scoreGuess(secret, candidate);
    tries++;
  }
  return [candidate, [r,w]];
}

// Generate 4 attempts with max red/white and unique solution
function generateAttempts(){
  attempts = [];
  possibleSolutions = allCombinations(symbols,L);

  for(let i=0;i<4;i++){
    let candidate, rw, filtered;
    let tries = 0;
    do {
      [candidate, rw] = generateCandidate(maxSettings[i].red, maxSettings[i].white);
      filtered = possibleSolutions.filter(sol=>{
        let [r,w] = scoreGuess(sol, candidate);
        return r===rw[0] && w===rw[1];
      });
      tries++;
    } while(filtered.length===0 && tries<100);
    attempts.push([candidate,rw]);
    filterSolutions(candidate,rw);
  }
}

// Display attempts
function displayAttempts(){
  const attemptsDiv = document.getElementById('attempts');
  attemptsDiv.innerHTML = '';
  attempts.forEach((att,i)=>{
    const div = document.createElement('div');
    div.className = 'attempt';
    div.textContent = `Attempt ${i+1}: ${att[0].join(' ')} ‚Üí Red: ${att[1][0]}, White: ${att[1][1]}`;
    attemptsDiv.appendChild(div);
  });
}

// Check 5th guess
function checkGuess(){
  let guess = [];
  for(let i=0;i<L;i++){
    guess.push(document.getElementById('g'+i).value);
  }
  if(guess.join('') === secret.join('')){
    document.getElementById('result').textContent = '‚úÖ Correct! You found the 5th move!';
  } else {
    document.getElementById('result').textContent = `‚ùå Incorrect. Secret was: ${secret.join(' ')}`;
  }
}

// Reveal solution
function revealSolution(){
  document.getElementById('result').textContent = `üí° Secret: ${secret.join(' ')}`;
}

// Initialize max red/white selectors
function initMaxSelectors(){
  const maxSelectorsDiv = document.getElementById('maxSelectors');
  maxSelectorsDiv.innerHTML = '';
  maxSettings = [];
  for(let i=0;i<4;i++){
    const div = document.createElement('div');
    div.innerHTML = `Attempt ${i+1} ‚Üí Max Red: <select id="red${i}"></select> Max White: <select id="white${i}"></select>`;
    maxSelectorsDiv.appendChild(div);
    const redSel = document.getElementById(`red${i}`);
    const whiteSel = document.getElementById(`white${i}`);
    for(let v=0;v<=L;v++){
      let optR = document.createElement('option'); optR.value=v; optR.textContent=v; redSel.appendChild(optR);
      let optW = document.createElement('option'); optW.value=v; optW.textContent=v; whiteSel.appendChild(optW);
    }
    maxSettings.push({red:2, white:2});
    redSel.value=2; whiteSel.value=2;
    // Update maxSettings when changed
    redSel.onchange = ()=>{ maxSettings[i].red = parseInt(redSel.value); initGame(); };
    whiteSel.onchange = ()=>{ maxSettings[i].white = parseInt(whiteSel.value); initGame(); };
  }
}

// Initialize the game
function initGame(){
  fillGuessDropdowns();
  // Generate secret
  secret = [];
  for(let i=0;i<L;i++){
    secret.push(symbols[Math.floor(Math.random()*symbols.length)]);
  }
  generateAttempts();
  displayAttempts();
  document.getElementById('result').textContent = '';
  console.log('Secret combo (for debugging):', secret);
}

// Initialize max selectors and start game
initMaxSelectors();
initGame();

</script>
</body>
</html>
